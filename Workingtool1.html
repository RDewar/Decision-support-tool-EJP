#All code is the product of work by Rob Dewar, Chris Gavin, and Oliver Tearne
<!DOCTYPE html>
<meta charset="utf-8">

<div id="root">
    <h1 id="title"></h1>
    <div align="right">
        <button type="button" class="reset" onclick="reset()">Reset</button>
    </div>

    <div id="main"></div>
</div>
<table style="width:500px; height: 400px; overflow:scroll; display:block; border-collapse:collapse" id="index"></table>
<table style="width:300px; height: 400px; overflow:scroll; display:none" id="table1">
    <tr>
    <tr>
        <td>Animal Health Impact
        </td>
    </tr>
    <tr>
        <td>Public Health Impact
        </td>
    </tr>
    <tr>
        <td>Social/Environmental Impact
        </td>
    </tr>
    <tr>
        <td>Economic/Trade Impact
        </td>
    </tr>
    <tr>
        <td>Impact on Biodiversity
        </td>
    </tr>
    <tr>
        <td>Potential for persistence, spread and mutation of disease
        </td>
    </tr>
</table>
<table style="width:300px; height: 400px; overflow:scroll; display:none" id="table2">

    <tr>
    <tr>
        <td>African Horse sickness
        </td>
    </tr>
    <tr>
        <td>African Swine fever
        </td>
    </tr>
    <tr>
        <td>Aino virus
        </td>
    </tr>
    <tr>
        <td>Akabane virus
        </td>
    </tr>
    <tr>
        <td>Alkhurma haemoragic fever
        </td>
    </tr>
    <tr>
        <td>Bhanja virus
        </td>
    </tr>
    <tr>
        <td>bluetongue
        </td>
    </tr>
    <tr>
        <td>bovine ephemeral fever
        </td>
    </tr>
    <tr>
        <td>Buyamwera virus
        </td>
    </tr>
    <tr>
        <td>Crimean-Congo haemoragic fever
        </td>
    </tr>
    <tr>
        <td>eastern equine encephalitus
        </td>
    </tr>
    <tr>
        <td>epizootic haemoragic disease
        </td>
    </tr>
    <tr>
        <td>equine encephalosis
        </td>
    </tr>
    <tr>
        <td>Getah virus
        </td>
    </tr>
    <tr>
        <td>heartwater
        </td>
    </tr>
    <tr>
        <td>hepatozoonosis (H.canis)
        </td>
    </tr>
    <tr>
        <td>Highlands J. virus
        </td>
    </tr>
    <tr>
        <td>Japanese encephalitis
        </td>
    </tr>
    <tr>
        <td>Kotonkan virus
        </td>
    </tr>
    <tr>
        <td>L. infantum
        </td>
    </tr>
    <tr>
        <td>main drain virus
        </td>
    </tr>
    <tr>
        <td>Middleburg virus
        </td>
    </tr>
    <tr>
        <td>Nairobi sheep disease
        </td>
    </tr>
    <tr>
        <td>Palyam virus
        </td>
    </tr>
    <tr>
        <td>Peruvian horse sickness
        </td>
    </tr>
    <tr>
        <td>Rift valley fever
        </td>
    </tr>
    <tr>
        <td>Saint Louis encephalitis
        </td>
    </tr>
    <tr>
        <td>Schmallenberg virus
        </td>
    </tr>
    <tr>
        <td>Shuni virus
        </td>
    </tr>
    <tr>
        <td>Thogoto virus
        </td>
    </tr>
    <tr>
        <td>Venezuelan equine encephalitis
        </td>
    </tr>
    <tr>
        <td>vesicular stomatitis
        </td>
    </tr>
    <tr>
        <td>Wesselbron virus
        </td>
    </tr>
    <tr>
        <td>West Nile fever
        </td>
    </tr>
    <tr>
        <td>Western equine encephalitis
        </td>
    </tr>
    <tr>
        <td>Yunnan orbivirus
        </td>
    </tr>
    <tr>
        <td>High Pathogenicity Avian influenza
        </td>
    </tr>
    <tr>
        <td>Newcastle Disease
        </td>
    </tr>
    <tr>
        <td>Low Pathogenicity Avian Influenza
        </td>
    </tr>
    <tr>
        <td>bluetongue
        </td>
    </tr>
    <tr>
        <td>Classical Swine fever
        </td>
    </tr>
    <tr>
        <td>Crimean-Congo haemoragic fever
        </td>
    </tr>
    </tr>
</table>
<table style="width:300px; height: 400px; overflow:scroll; display:none" id="table3">

    <tr>
    <tr>
        <td>Anisakidae and Anisakiasis
        </td>
    </tr>
    <tr>
        <td>Ascaris spp.
        </td>
    </tr>
    <tr>
        <td>Blantidium coli
        </td>
    </tr>
    <tr>
        <td>Cryptosporidiosis
        </td>
    </tr>
    <tr>
        <td>Diphyllobothrium spp.
        </td>
    </tr>
    <tr>
        <td>Echinococcus granulosus
        </td>
    </tr>
    <tr>
        <td>Echinococcus multicularis
        </td>
    </tr>
    <tr>
        <td>Entamoeba hystolytica
        </td>
    </tr>
    <tr>
        <td>Fasciola spp.
        </td>
    </tr>
    <tr>
        <td>Giardia duodenalis
        </td>
    </tr>
    <tr>
        <td>Heterophidae and Heterophidiasis
        </td>
    </tr>
    <tr>
        <td>Opsthorchidae
        </td>
    </tr>
    <tr>
        <td>Paragonimus spp.
        </td>
    </tr>
    <tr>
        <td>Sarcocystis spp.
        </td>
    </tr>
    <tr>
        <td>Spirometra spp.
        </td>
    </tr>
    <tr>
        <td>Taenia saginata
        </td>
    </tr>
    <tr>
        <td>Taenia solium
        </td>
    </tr>
    <tr>
        <td>Toxicara spp.
        </td>
    </tr>
    <tr>
        <td>Toxoplasma gondii
        </td>
    </tr>
    <tr>
        <td>Trichinella spp. Other than T.spiralis
        </td>
    </tr>
    <tr>
        <td>Trichinella spiralis
        </td>
    </tr>
    <tr>
        <td>Tichuris trichiura
        </td>
    </tr>
    <tr>
        <td>Trypanosoma cruzi
        </td>
    </tr>
    </tr>
</table>
<table style="width:300px; height: 400px; overflow:scroll; display:none" id="table4">

    <tr>
    <tr>
        <td>African Swine fever
        </td>
    </tr>
    <tr>
        <td>Aujesky's disease
        </td>
    </tr>
    <tr>
        <td>Avian Influenza
        </td>
    </tr>
    <tr>
        <td>Bluetongue
        </td>
    </tr>
    <tr>
        <td>Classical Swine Fever
        </td>
    </tr>
    <tr>
        <td>Equine Viral Arteritis
        </td>
    </tr>
    <tr>
        <td>Foot-and-Mouth Disease
        </td>
    </tr>
    <tr>
        <td>Rabies
        </td>
    </tr>
    <tr>
        <td>West Nile Fever
        </td>
    </tr>
    <tr>
        <td>Bovine Spongiform Encephalopathy
        </td>
    </tr>
    <tr>
        <td>Bovine Tuberculosis
        </td>
    </tr>
    <tr>
        <td>BVD
        </td>
    </tr>
    <tr>
        <td>Campylobacteriosis
        </td>
    </tr>
    <tr>
        <td>Equine Influenza
        </td>
    </tr>
    <tr>
        <td>Foot Rot
        </td>
    </tr>
    <tr>
        <td>PMWS
        </td>
    </tr>
    <tr>
        <td>Salmonella spp.
        </td>
    </tr>
    <tr>
        <td>Toxoplasmosis (cats)
        </td>
    </tr>
    <tr>
        <td>Toxoplasmosis (sheep)
        </td>
    </tr>
    <tr>
        <td>VTEC
        </td>
    </tr>
    <tr>
        <td>Lameness
        </td>
    </tr>
    <tr>
        <td>Sow Crates
        </td>
    </tr>
    </tr>
</table>

<style>
    body {
        font-family: sans-serif;
    }

    h1 {
        margin-left: 0.2em;
    }

    div#root,
    div#notes {
        max-width: 30em;
        background-color: #EEE;
        border: 1px solid #DDD;
        padding: 0.3em;
    }

    div.buttons {
        background: #CCC;
        border: 1px solid #BBB;
        padding: 0.2em;
        margin: 0.1em;
        margin-bottom: 0.5em;
    }

    button {
        padding: 0.1em 0.4em;
        margin: 0.2em;
        display: block;
        font-family: helvetica;
        font-size: 16px;
        font-weight: 100;
        text-align: left;
        color: #fff;
        background: #688296;
        border: 1px solid #555;
        font-weight: 100;
        cursor: pointer;
    }

    button:hover {
        background: #4B6C86;
        border: 1px solid #000;
    }

    button.selected {
        background: #363;
    }

    button.reset {
        font-size: 75%;
        background: #a33;
    }

    button.reset:hover {
        background: #C33
    }

    #T1button {
        position: absolute;
        left: 500px;
        top: 10px;
    }

    #T2button {
        position: absolute;
        left: 570px;
        top: 10px;
    }

    #T3button {
        position: absolute;
        left: 640px;
        top: 10px;
    }

    #T4button {
        position: absolute;
        left: 710px;
        top: 10px;
    }

    #T5button {
        position: absolute;
        left: 780px;
        top: 10px;
    }

    table {
        position: absolute;
        left: 500px;
        top: 40px;
        padding: 10px;
        border: 1px solid black;
    }
    tr {
        border:1px solid black;
    }
   
    td{
        border:1px solid black;
    }

    a.link {
        color: black;
        background: palegoldenrod;
        text-decoration: none;
    }

    a:visited {
        color: black;
        text-decoration: none;
    }

    a:hover {
        color: hotpink;
        text-decoration: none;
    }

    a:active {
        text-decoration: none;
    }
</style>

<script type="text/javascript">
    let main = document.getElementById("main");
    let rootData = getData();
    let toolData = getTools();
    // passes the whole data structure through the script 
    document.getElementById("title").innerText = rootData.title
    askQuestion(rootData);


    let index = document.getElementById("index");
        toolData.tools.forEach(function(object) {
            let tr = document.createElement("tr");
            tr.innerHTML =  '<td>'+ object.name + '</td>' +
            '<td>'+ object.info +'</td>';
            tr.setAttribute("border", "solid")
            index.appendChild(tr);
        });


    // attributes a level to the question asked, level 0 being the default, the root of the tree
    function askQuestion(subTree, levelIdx = 0) {
        let levelDiv = document.createElement("div");
        levelDiv.setAttribute("id", "Div1");
        levelDiv.className = "level";
        levelDiv.id = levelIdx;
        main.appendChild(levelDiv);
        //if there is an outcome there will be no more questions, otherwise questions will feed in
        if (subTree.hasOwnProperty('outcomes')) {
            hideAllLists()

            subTree.outcomes.forEach(outcome => {
                var toolElement = getToolByName(toolData.tools, outcome) // look up by name in the tools data set

                var linkElement = document.createElement("a") // attach href-link element 
                linkElement.href = toolElement.link
                linkElement.target = "_.blank"
                linkElement.text = toolElement.name

                levelDiv.appendChild(linkElement);
                levelDiv.appendChild(document.createElement("P")); // add some space between different outcomes

                if (toolElement.hasOwnProperty('info')) { // only attach the "info" if it exists
                    var infoPara = document.createElement("P")
                    infoPara.innerText = toolElement.info
                    levelDiv.appendChild(infoPara)
                }
            })
        }
        else {
            if (subTree.hasOwnProperty('actions')) {
                hideAllLists()
                var scriptElement = document.createElement("script")
                scriptElement.text = subTree.actions
                levelDiv.appendChild(scriptElement)
            } else { hideAllLists() }
            levelDiv.appendChild(document.createTextNode(subTree.question));
            showOptions();
        }

        //creates the responses panel
        function showOptions() {
            let responsePanel = document.createElement("div");
            responsePanel.className = "buttons";
            levelDiv.appendChild(responsePanel);
            //creates a button with the answers on
            subTree.responses.forEach(response => {
                let btn = document.createElement("button");
                btn.type = "button";
                btn.innerHTML = response.answer;
                //Removes any questions after a given point should you go back and click on a different answer to previously
                //Also will add the next level question below using askQuestion function
                //Also will remove the selected formatting should a different option be taken to before.
                btn.onclick = () => {
                    removeDescendantsOf(levelIdx);
                    askQuestion(response, levelIdx + 1);
                    responsePanel
                        .querySelectorAll("button")
                        .forEach(b => {
                            if (b == btn) b.className = "selected"
                            else b.classList.remove("selected")
                        });
                }
                responsePanel.appendChild(btn);
            })
        }
    }

    function removeDescendantsOf(levelIdx) {
        let len = main.childNodes.length;

        [...main.querySelectorAll("div.level")]
            .filter(d => d.id > levelIdx)
            .forEach(d => main.removeChild(d));
    }

    function reset() {
        removeDescendantsOf(0);
        main.querySelectorAll("button")
            .forEach(b => b.classList.remove("selected"));
            hideAllLists();
            showindex();
    }

    function hideAllLists() {
        document.getElementById("index").style.display = "none";
        document.getElementById("table1").style.display = "none";
        document.getElementById("table2").style.display = "none";
        document.getElementById("table3").style.display = "none";
        document.getElementById("table4").style.display = "none";
    }

    function show1() {
        document.getElementById("table1").style.display = "block";
    }
    function show2() {
        document.getElementById("table2").style.display = "block";
    }
    function show3() {
        document.getElementById("table3").style.display = "block";
    }
    function show4() {
        document.getElementById("table4").style.display = "block";
    }
    function showindex(){
        document.getElementById("index").style.display = "block";
    }

    function getData() {
        return {
            "title": "EJP decision making tool",
            "question": "Do you require a rapid outcome to your risk assessment?",
            "actions": "showindex()",
            "responses": [
                {
                    "answer": "Yes",
                    "question": "Which of the following best describes your requirements with regards to a risk assessment method?",
                    "responses": [
                        {
                            "answer": "A rapid risk assessment tool with simple numerical output, or disease prioritisation",
                            "question": "Are you considering a specific disease, if so, does it appear on the following list?",
                            "actions": "show2()",
                            "responses": [
                                {
                                    "answer": "Yes",
                                    "question":"Is your disease of interest vector borne?",
                                    "responses":[
                                        {
                                            "answer":"Yes",
                                            "outcomes":["MINTRISK"]
                                        },
                                        {
                                            "answer":"No",
                                            "outcomes":["SPARE"]
                                        }
                                    ]
                                },
                                {
                                    "answer": "No",
                                    "question": "Do the criteria you want to assess appear on the following list? Or would you prefer to customise the criteria?",
                                    "actions": "show1()",
                                    "responses": [
                                        {
                                            "answer": "Predefined criteria",
                                            "outcomes": ["Simplified generic prioritisation tool (France)"]
                                        },
                                        {
                                            "answer": "Custom criteria",
                                            "outcomes": ["ECDC tool for the prioritisation of infectious diseases"]
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            "answer": "Rapid qualitative risk assessment method, outputting a report or similar written document",
                            "question": "Is risk assessment specifically for emerging threats?",
                            "responses": [
                                {
                                    "answer": "Yes",
                                    "outcomes": ["HAIRS RA Framework"]
                                },
                                {
                                    "answer": "No",
                                    "outcomes": ["OIE qualitative risk assessment framework"]
                                }
                            ]
                        }
                        ]
                },
                {
                    "answer":"No",
                    "question":"Are you looking for methods of constructing a more bespoke risk assessment tool that can be used to generate rapid risk outputs in the future?",
                    "responses":[
                            {
                            "answer": "Yes",
                            "question": "Is your tool concerned with predicting the risk of incursion or disease monitoring or assessment of impact on public health/economy etc?",
                            "responses": [
                                {
                                    "answer": "Incursion or disease monitoring",
                                    "question": "Is the risk assessment concerned with companion animals?",
                                    "responses": [
                                        {
                                            "answer": "Yes",
                                            "outcomes": ["Prioritisation of companion animal diseases tool"]
                                        },
                                        {
                                            "answer": "No",
                                            "outcomes": ["IDM Risk of incursion tool"]
                                        }
                                    ]
                                },
                                {
                                    "answer": "Soicial, Public Health, Economic impact assessment",
                                    "question": "Would the tool be designed for parasitic disease, as in the following list?",
                                    "actions": "show3()",
                                    "responses": [
                                        {
                                            "answer": "Yes",
                                            "outcomes": ["Multicriteria based food borne parasite tanking system"]
                                        },
                                        {
                                            "answer": "No",
                                            "question": "Would the tool have a public health focus, or encompass more criteria?",
                                            "responses": [
                                                {
                                                    "answer": "Public Health focussed",
                                                    "outcomes": ["Belgian Multidisciplinary evidence based prioritisation tool"],
                                                },
                                                {
                                                    "answer": "Considering several criteria",
                                                    "outcomes": ["D2R2", "Emerging Threat Highlight Report"]
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            "answer": "No",
                            "question":"Are you looking to conduct a full risk assessment, to calculate accurate risk around a particular disease or scenario?",
                            "responses":[
                                {
                                    "answer":"Yes",
                                    "question":"What level of data do you have available for your risk assessment?",
                                    "responses":[
                                        {
                                            "answer": "Accurate surveillance, trade, and/or prevalence data?",
                                            "outcomes": ["OIE quantitative risk assessment guidance", "Monte Carlo Simulation"] 
                                        },
                                        {
                                            "answer": "Data which may be limited in areas of surveillance, trade or prevalence",
                                            "outcomes": ["OIE qualitative risk assessment framework"]
                                        }
                                    ]
                                },
                                {
                                    "answer":"No",
                                    "outcomes":["OIE qualitative risk assessment framework"]
                                }
                            ]
                        }
                    ]
                }
            ]
    }
    }
        function getToolByName(tools, name) {
            var found = null;

            for (var i = 0; i < tools.length; i++) {
                var element = tools[i];

                if (element.name == name) {
                    found = element;
                    break;
                }
            }

            return found;
        }

        function getTools() {
            return {
                "tools":
                    [
                        {
                            "name": "Belgian Multidisciplinary evidence based prioritisation tool",
                            "link": "https://www.researchgate.net/publication/223982140_Multidisciplinary_and_Evidence-based_Method_for_Prioritizing_Diseases_of_Food-producing_Animals_and_Zoonoses",
                            "info": "Little information exists on this tool, however, it is known to consider public health impacts of a range of diseases. It may be a good source of inspiration for building a similar tool."
                        },
                        {
                            "name":"HAIRS RA Framework",
                            "link":"https://assets.publishing.service.gov.uk/government/uploads/system/uploads/attachment_data/file/761106/HAIRS_risk_assessment_processes.pdf",
                            "info":"The Human Animal Infections and Risk Surveillance (HAIRS) group operate across all sectors of OneHealth to detect emerging threats early, assess these, and summarise them in to a concise, rapid and in depth report. Many Central Competent authorities rely on these risk assessments to inform them of emerging threats."
                        },
                        {
                            "name": "MINTRISK",
                            "link": "https://www.wecr.wur.nl/mintrisk/",
                            "info": "Standing for 'Method for INTegrated RISK assessment', this tool specialises in vector borne animal diseases. The disease risks are kept up to date, making it, of the off-the-shelf tools available, among the more reliable. The risk estimation is optimised for disease incursion in to and transfer between European countries, ranking the peramaterised diseases in terms of risk severity."
                        },
                        {
                            "name": "SPARE",
                            "link": "https://www.researchgate.net/publication/332997045_A_spatial_risk_assessment_model_framework_for_incursion_of_exotic_animal_disease_into_the_European_Union_Member_States",
                            "info": "This tool was designed to be a generic tool for disease risk estimation, built in a web-based app. This tool will be able to rank the aforementioned diseases based on a range of criteria. The 'weight' that you attribute to criteria, depending on their perceived importance, will affect the ranking of these diseases."
                        },
                        {
                            "name": "Multicriteria based food borne parasite tanking system",
                            "link": "https://www.who.int/foodsafety/publications/mra_23/en/",
                            "info": "The criteria in this tool were defined by expert opinion, ranking parasitic diseases in global terms. Their distribution, morbidity, and social, trade and economic impacts on host countries were assessed in tandem, though these were weighted with an 85% bias towards public health."
                        },
                        {
                            "name": "D2R2",
                            "link": "https://www.ncbi.nlm.nih.gov/pubmed/27707948",
                            "info": "Though the information basis for this prioritisation tool is thought to be out-dated, most of its data sources are up to date, and cover a huge spectrum of criteria. This tool is a good framework to draw inspiration off if you are looking to build a tool for prioritising endemic and exotic infectious diseases."
                        },
                        {
                            "name": "Prioritisation of companion animal diseases tool",
                            "link": "http://www.callistoproject.eu/callisto/",
                            "info": "This is the only known risk assessment tool working with companion animals. It is hence a good starting point for anyone looking to create risk tool involving companion animals"
                        },
                        {
                            "name": "ECDC tool for the prioritisation of infectious diseases",
                            "link": "https://ecdc.europa.eu/en/publications-data/ecdc-tool-prioritisation-infectious-disease-threats",
                            "info": "This tool is useful when information in limited but you still need a rapid output. It will prioritise diseases based on criteria that you define youself and attribute weights to. In a seperate sheet it calculates the risk or impact of these criteria for a particular disease (also difined by the user) and reanks the diseases in terms of severity. It is recommended to use this to supplement a full qualitative risk assessment."
                        },
                        {
                            "name": "Simplified generic prioritisation tool (France)",
                            "link": "https://www.anses.fr/en/content/two-tools-prioritising-animal-diseases-available-online",
                            "info": "Though the tool works only in French, it is a good way to estimate a large number of risks and impacts. This will provide a numeric risk estimate, and uncertainty estimate."
                        },
                        {
                            "name": "Emerging Threat Highlight Report",
                            "link": "https://data.gov.uk/dataset/d2bd7435-6ebb-41f0-a34c-fe264bb4ed21/emerging-threats-highlight-report-ethir",
                            "info":"This tool was designed to identify, assess and report on the threats and vulnerabilities entering the UK. It encompasses three main areas of impact assessment: actual impact, potential impact, and public perception. Crucially ETHiR is not limited to disease threats; threats such as the Icelandic dust cloud are known to have been assessed using this tool."
                        },
                        {
                            "name": "Monte Carlo Simulation",
                            "link": "https://www.ncbi.nlm.nih.gov/pubmed/23569196",
                            "info":"This is the among the simplest and most common methods of predictive quantitative risk assessments. At its core, this form of simulation relies on random sampling from a distribution of epidemiological data to work out basic probabilities and risks of something occurring. These may then be used to produce further distributions or integrate with other probabilities in to a cumulative probability that a particular situation occurs."
                        },
                        {
                            "name": "OIE quantitative risk assessment guidance",
                            "link": "https://www.oie.int/doc/ged/D11250.PDF",
                            "info": "This will provide the very basics of quantitative risk assessment. Applications such as Matlab, @Risk, R and Python are widely used in these risk assessments and building models based on this framework may be challenging, however such risk assessments are good ways of attributing a numerical risk to a range of criteria and to specific situations."
                        },
                        {
                            "name": "OIE qualitative risk assessment framework",
                            "link": "http://www.rr-africa.oie.int/docspdf/en/2018/SIT/Handbook_on_Import_Risk_Analysis_-_OIE_-_Vol__I.pdf",
                            "info": "This is the bread and butter of OneHealth risk assessment. This framework is applicable to most if not all health-related risk assessments, and divides the process in to clearly defined segments. Most other qualitative frameworks are based in some way on this guidance document."
                        },
                        {
                            "name": "IDM Risk of incursion tool",
                            "link": "https://www.researchgate.net/publication/51084035_Assessing_the_risk_of_disease_introduction_in_imports",
                            "info": "This tool continues to be used to inform policy in the UK. Despite its simple excel format, this tool takes in to account a staggering number of variables. Where there is good data on trade and prevalence associated with a particular disease, an approach such as this is highly recommended."
                        }
                    ]
            }
        }
</script>
